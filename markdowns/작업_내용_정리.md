 # Persona-AI 프로젝트 작업 내용 정리

이 문서는 현재까지 Persona-AI 프로젝트에 대해 진행된 분석 및 수정 작업을 요약합니다.

---

## 1. 프로젝트 초기 분석

- **요청:** 프로젝트 분석 요청
- **작업:** `README.md`, `requirements.txt`, `app.py`, `core` 디렉터리 등 핵심 파일들을 분석하여 프로젝트의 전체적인 구조와 목적, 기술 스택을 파악했습니다.
- **결론:** 실시간 회의 내용을 분석하여 디지털 페르소나를 구축하는 PyQt 기반의 데스크톱 애플리케이션임을 확인했습니다. (화자 분리, STT, RAG, QLoRA 등)

---

## 2. UI 리팩토링

- **요청:** `meeting_console.py`의 요약/액션 아이템 표시 기능을 `meeting_notes.py`로 통합 요청.
- **작업:**
    1. `meeting_notes.py`에 `update_notes` 함수를 추가하여 외부에서 요약/전사 내용을 업데이트할 수 있도록 구조를 변경했습니다.
    2. `meeting_console.py`의 `on_summarize`, `_display_file_result` 함수가 `update_notes`를 호출하도록 수정하여 UI 로직을 통합했습니다.
    3. 중간에 요약/액션/전사 분리 UI를 시도했으나, 사용자 요청에 따라 최종적으로 **요약+액션 아이템**과 **전사** 2단 분리 구조로 되돌렸습니다.

---

## 3. RAG 기능 진단 및 수정

- **문제 진단:** 사용자는 RAG 기능이 동작하지 않는다고 보고했습니다.
- **1차 원인 분석:** `chat_dock.py`(페르소나 챗봇)은 RAG 기능이 없으며, 본래 RAG 기능이 있던 `Q&A` 탭이 비활성화된 상태였습니다.
- **1차 수정:**
    - `meeting_console.py`에서 생성된 `RagStore` 객체를 `chat_dock.py`로 전달했습니다.
    - `chat_dock.py`의 `on_send` 함수를 수정하여, 질문 시 RAG 검색을 수행하고, 검색된 내용을 프롬프트에 포함시켜 LLM에 전달하도록 RAG 연동 기능을 구현했습니다.

- **2차 원인 분석:** RAG 연동 후에도 기능이 제대로 동작하지 않는다는 추가 보고가 있었습니다. 분석 결과, Vector DB에 **AI 요약문이 아닌 최근 대화 몇 줄만 저장**되고 있었음을 확인했습니다.
- **2차 수정:**
    - `meeting_console.py`의 `on_summarize`, `_display_file_result` 함수가 `summarizer.py`의 실제 AI 요약 함수인 `llm_summarize`를 호출하도록 변경했습니다.
    - 이렇게 생성된 **실제 AI 요약문**이 Vector DB에 저장되도록 `_save_summary_to_rag` 함수와 그 호출 부분을 수정했습니다.

- **3차 원인 분석:** `meeting_notes.py`의 자체 파일 업로드 기능에서는 여전히 RAG 저장이 누락되어 있음을 확인했습니다.
- **3차 수정:**
    - `meeting_notes.py`가 `meeting_console.py`의 RAG 저장 함수(`_save_summary_to_rag`)를 호출할 수 있도록 구조를 변경하고, 파일 처리 완료 시 RAG 저장이 실행되도록 코드를 추가했습니다.

---

## 4. 편의 기능 추가

- **요청:** 설정 탭에 Vector DB 초기화 버튼 추가 요청.
- **작업:**
    1. `meeting_console.py`의 `_build_settings_tab` 함수에 'Vector DB 초기화' 버튼을 추가했습니다.
    2. 버튼 클릭 시, 사용자에게 재확인 메시지를 표시한 후 `rag_store.py`의 `clear_collection` 함수를 호출하여 DB를 초기화하는 `on_clear_vector_db` 함수를 구현했습니다.

- **요청:** RAG 동작 디버깅을 위한 콘솔 출력 요청.
- **작업:**
    1. `chat_dock.py`의 `on_send` 함수에 `print` 구문을 추가하여, **사용자 질문**과 **RAG 검색 결과**가 콘솔에 출력되도록 했습니다.
    2. `meeting_console.py`의 `_save_summary_to_rag` 함수에 `print` 구문을 추가하여, **Vector DB에 저장되는 문서의 내용**이 콘솔에 출력되도록 했습니다.

---

## 5. QLoRA 기능 상태 분석

- **요청:** QLoRA를 이용한 페르소나 말투 모방 기능의 아이디어 적절성 및 현재 구현 상태 확인 요청.
- **분석 결과:**
    - **아이디어:** QLoRA는 해당 기능 구현에 매우 적합한 최신 기술입니다.
    - **구현 상태:** **부분적으로만 구현**되어 있습니다.
        - **구현된 부분:** 학습 데이터 생성(`persona_training.py`), 학습된 어댑터를 사용한 추론(`adapter.py`).
        - **누락된 부분:** 생성된 데이터셋으로 **실제 QLoRA 어댑터를 학습시키는 핵심 로직(학습 스크립트)이 부재**하며, `requirements.txt`에도 `peft` 등 관련 라이브러리가 빠져있습니다.
